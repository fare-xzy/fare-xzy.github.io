# 计算机网络基础

## OSI七层模型

OSI（Open Systems Interconnection）参考模型是国际标准化组织（ISO）制定的一个用于计算机或通信系统间互联的标准体系，一般称为OSI参考模型或七层模型。它将计算机网络体系结构划分为七层，自下而上依次为：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。

![OSI七层模型](../../pic/系统架构师/osi-model.jpg)

### 一、各层详解

#### 1. 物理层 (Physical Layer)
- **功能**：利用传输介质为数据链路层提供物理连接，实现比特流的透明传输。
- **数据单位**：比特 (Bit)
- **典型设备**：中继器 (Repeater)、集线器 (Hub)、网线、光纤
- **典型协议**：EIA-232, RJ-45, V.35

#### 2. 数据链路层 (Data Link Layer)
- **功能**：在物理层提供的比特流基础上，通过差错控制、流量控制方法，将有差错的物理线路变为无差错的数据链路。
- **数据单位**：帧 (Frame)
- **典型设备**：网桥 (Bridge)、交换机 (Switch)、网卡 (NIC)
- **典型协议**：Ethernet, PPP, HDLC, ARP/RARP, VLAN (802.1Q)

#### 3. 网络层 (Network Layer)
- **功能**：负责为分组交换网上的不同主机提供通信服务。主要任务是路由选择、分组转发、流量控制、拥塞控制。
- **数据单位**：数据包/分组 (Packet)
- **典型设备**：路由器 (Router)、三层交换机
- **典型协议**：IP (IPv4/IPv6), ICMP, IGMP, OSPF, BGP, RIP

#### 4. 传输层 (Transport Layer)
- **功能**：负责主机中两个进程之间的通信（端到端通信）。提供可靠（TCP）或不可靠（UDP）的数据传输服务，以及差错控制和流量控制。
- **数据单位**：数据段 (Segment) / 数据报 (Datagram)
- **典型协议**：TCP, UDP

#### 5. 会话层 (Session Layer)
- **功能**：负责建立、管理和终止表示层实体之间的通信会话。提供会话管理服务，如令牌管理、同步点设置。
- **典型协议**：RPC, SQL, NFS

#### 6. 表示层 (Presentation Layer)
- **功能**：处理两个通信系统中交换信息的表示方式。主要包括数据格式转换、数据加密/解密、数据压缩/解压。
- **典型协议**：JPEG, MPEG, ASCII, EBCDIC, SSL/TLS

#### 7. 应用层 (Application Layer)
- **功能**：直接为用户的应用进程提供服务，是用户与网络的接口。
- **典型协议**：HTTP, FTP, SMTP, DNS, Telnet, SSH

### 二、OSI七层模型汇总表

| 层级 | 名称 | 功能关键词 | PDU (协议数据单元) | 典型设备 | 典型协议 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 7 | 应用层 | 网络服务接口 | 数据 | 计算机/网关 | HTTP, FTP, SMTP |
| 6 | 表示层 | 格式/加密/压缩 | 数据 | 网关 | JPEG, ASCII |
| 5 | 会话层 | 会话管理 | 数据 | 网关 | RPC, NFS |
| 4 | 传输层 | 端到端/可靠性 | 段 (Segment) | 网关/防火墙 | TCP, UDP |
| 3 | 网络层 | 路由/寻址 | 包 (Packet) | 路由器 | IP, ICMP |
| 2 | 数据链路层 | 帧同步/MAC | 帧 (Frame) | 交换机/网桥 | Ethernet, ARP |
| 1 | 物理层 | 比特流传输 | 比特 (Bit) | 集线器/中继器 | RJ-45 |

### 三、记忆口诀
- **应表会传网链物**（自上而下）：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。
- **All People Seem To Need Data Processing** (自上而下)：Application, Presentation, Session, Transport, Network, Data Link, Physical.
- **Please Do Not Throw Sausage Pizza Away** (自下而上)：Physical, Data Link, Network, Transport, Session, Presentation, Application.

## 数据通信基本原理

### 信道容量与数据速率

在数据通信中，信道容量和数据速率是两个基本概念，它们分别由香农理论和奈奎斯特定理描述。

#### 奈奎斯特定理（Nyquist Theorem）

奈奎斯特定理描述了在理想无噪声环境下，信道的最大数据传输速率：

**B = 2W**

其中：
- B：码元速度，单位为波特(Baud)
- W：信道带宽，单位为赫兹(Hz)

奈奎斯特定理表明，在理想条件下，信道的码元传输速率最大为带宽的两倍。

#### 数据速率计算

数据速率R与码元速度B的关系：

**R = B log₂N**

其中：
- R：数据速率，单位为比特/秒(bps)
- B：码元速度，单位为波特(Baud)
- N：码元种类数，由调制技术决定

#### 香农理论（Shannon Theory）

香农理论考虑了噪声对信道容量的影响，给出了有噪声信道的极限数据速率：

**C = W log₂(1+S/N)**

其中：
- C：信道的极限数据速率，单位为比特/秒(bps)
- W：信道带宽，单位为赫兹(Hz)
- S：信号平均功率
- N：噪声平均功率
- S/N：信噪比

### 数据通信系统模型

数据通信系统主要包含以下几个关键组件及其关系：

1. **带宽(W)**：信道可用的频率范围，直接影响码元速度
2. **噪声影响**：环境噪声降低信道容量，通过信噪比(S/N)表示
3. **码元速度(B)**：由奈奎斯特定理确定，B = 2W
4. **调制技术**：决定码元种类数(N)
5. **数据速率(R)**：最终的比特传输速率，R = B log₂N

### 实际应用

在实际通信系统设计中：
- 增加带宽(W)可以提高码元速度
- 改进调制技术可以增加码元种类数(N)
- 降低噪声或提高信号功率可以提高信噪比(S/N)

这些措施都可以提高数据传输速率，但都受到物理和技术条件的限制。

# 网络连接中的半连接和已完成连接

> `半连接`：服务端收到客户端`syn`后,将连接放入半连接队列。如果半连接队列已满会丢弃，客户端报错`connection time out`
> 
> `已完成连接`：服务端收到客户端的`ack`后，从半连接队列中拿出连接放入已完成连接队列。如果已完成连接队列已经满则无法放入，客户端报错`read timeout` 或者 `connection reset by peer`
> 
> `syn:`SYN是TCP/IP建立连接时使用的握手信号。在客户机和服务器之间建立正常的TCP网络连接时，客户机首先发出一个SYN消息，服务器使用SYN+ACK应答表示接收到了这个消息，最后客户机再以ACK消息响应。这样在客户机和服务器之间才能建立起可靠的TCP连接，数据才可以在客户机和服务器之间传递
> 
> `ack:`在TCP报文段中，字段ACK=1时，确认号字段才有效。TCP规定，在连接建立后所有传送的报文段都必须把ACK置1

## JDK和TLS协议的版本关系

![](https://img-blog.csdnimg.cn/20181226233209538.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L01lbG9fRmVuZ1poaQ==,size_16,color_FFFFFF,t_70)

###### TCP

在 `netstat` 命令的输出中，`TIME_WAIT` 是 TCP 连接状态之一。下面是一些常见的 TCP 连接状态以及它们的说明：

1. `ESTABLISHED`（已建立）：表示已经建立的 TCP 连接。数据可以在双方之间传输。

2. `SYN_SENT`（发送 SYN）：表示正在向远程主机发送连接请求（SYN）的状态。在双方建立连接之前，发送方会先发送 SYN 报文。

3. `SYN_RECEIVED`（接收 SYN）：表示正在等待远程主机的连接确认（SYN/ACK）的状态。接收方已经收到连接请求并发送了确认。

4. `FIN_WAIT1`（等待终止阶段1）：表示连接的一方发送了关闭连接请求（FIN）并等待对方的确认。此状态通常是在发送方先关闭连接时出现。

5. `FIN_WAIT2`（等待终止阶段2）：表示接收到对方的关闭连接请求（FIN），并已经发送了确认，但仍在等待对方发送关闭连接的确认。

6. `TIME_WAIT`（等待时间）：表示连接已经被关闭，但仍然保持在此状态的一段时间。在此期间，系统会保留连接的信息以处理可能滞后的数据包。

7. `CLOSE_WAIT`（等待关闭）：表示连接的一方已经发送了关闭连接请求（FIN），并等待对方的确认。这是接收方在接收到关闭请求后的状态。

8. `LAST_ACK`（最后确认）：表示连接的一方发送了关闭连接请求（FIN），并等待对方的确认。这是发送方在接收到对方的确认后的状态。

9. `LISTEN`（监听）：表示正在侦听传入连接请求的状态，通常用于服务器端等待连接的状态。

以上是一些常见的 TCP 连接状态，其中 `TIME_WAIT` 是一个特殊的状态，表示连接已经关闭但仍在等待一段时间，以确保所有相关的数据包都被处理完毕。这是为了防止旧的连接请求与新的连接请求混淆。

请注意，`netstat` 命令的输出可能因操作系统和版本的不同而略有差异，因此具体的连接状态可能会有所变化。可以使用 `netstat --help` 或 `man netstat` 命令来查看特定操作系统中 `netstat` 命令的帮助文档，以获取更详细的信息。


## 标签
#计算机网络 #数据通信 #香农理论 #奈奎斯特定理 #信道容量 #带宽

