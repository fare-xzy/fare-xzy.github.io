# 线上问题

## 服务器异常关机
在CentOS 7系统中，突然关机的相关记录可以通过**系统日志**查询，核心日志文件和命令如下：


### 一、查看关机/重启记录（最直接）
使用 `last` 命令查看系统的开关机、用户登录历史：
```bash
last -x | grep shutdown  # 查看关机记录
last -x | grep reboot    # 查看重启记录
```
- 输出中会显示关机的**时间**、**执行用户**（若为意外关机，可能显示 `systemd-shutdown`）。


### 二、查看系统日志（分析关机原因）
CentOS 7默认使用 `systemd-journald` 管理日志，可通过以下命令查询关机前后的系统状态：

#### 1. 查看最近的系统日志（包含关机信息）
```bash
journalctl -b -1  # 查看上一次启动周期的日志（-b表示当前启动，-1表示上一次）
journalctl -u systemd-shutdown  # 查看关机流程的日志
```

#### 2. 按时间筛选关机前后的日志
如果知道大致关机时间，可通过时间范围过滤：
```bash
journalctl --since "2026-01-14 10:00:00" --until "2026-01-14 10:30:00"
```
- 重点关注日志中的关键词：`shutdown`、`power off`、`kernel panic`（内核崩溃）、`OOM`（内存耗尽）、`hardware error`（硬件错误）。


### 三、查看内核/硬件相关日志
如果是硬件故障（如电源、CPU过热），可查看内核日志：
```bash
dmesg | grep -i error  # 查看内核错误信息
cat /var/log/messages | grep -i shutdown  # 传统系统日志（部分CentOS 7仍会记录）
```


### 四、常见意外关机的日志特征
- **硬件故障**：日志中会出现 `temperature`（温度过高）、`power supply`（电源异常）等关键词；
- **内核崩溃**：会出现 `kernel panic`、`BUG` 等严重错误信息；
- **内存耗尽**：会出现 `Out of memory`、`kill process` 等OOM相关日志；
- **人为强制关机**：`last` 命令会显示 `shutdown` 由 `root` 用户执行。

### 五、排查结果
- 日志中有明显的1月 12 21:58:23 BJCADevice systemd-logind[852]: Power key pressed.记录。在 1 月 12 日 21:58:23 这个时间点，有人按下了服务器的物理电源键